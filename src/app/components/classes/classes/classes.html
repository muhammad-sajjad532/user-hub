<div class="dashboard-wrapper">
  
  <!-- Sidebar -->
  <aside class="sidebar" [class.collapsed]="isSidebarCollapsed">
    <div class="logo-section">
      <div class="logo">
        <i class="bi bi-mortarboard-fill"></i>
      </div>
      <h3 class="logo-text" *ngIf="!isSidebarCollapsed">School MS</h3>
    </div>

    <nav class="sidebar-menu">
      <a href="javascript:void(0)" class="menu-item" [class.active]="activeMenu === 'dashboard'" (click)="setActiveMenu('dashboard')">
        <i class="bi bi-grid-fill"></i>
        <span *ngIf="!isSidebarCollapsed">Dashboard</span>
      </a>
      <a href="javascript:void(0)" class="menu-item" [class.active]="activeMenu === 'students'" (click)="setActiveMenu('students')">
        <i class="bi bi-people-fill"></i>
        <span *ngIf="!isSidebarCollapsed">Students</span>
      </a>
      <a href="javascript:void(0)" class="menu-item" [class.active]="activeMenu === 'teachers'" (click)="setActiveMenu('teachers')">
        <i class="bi bi-person-badge-fill"></i>
        <span *ngIf="!isSidebarCollapsed">Teachers</span>
      </a>
      <a href="javascript:void(0)" class="menu-item" [class.active]="activeMenu === 'classes'" (click)="setActiveMenu('classes')">
        <i class="bi bi-book-fill"></i>
        <span *ngIf="!isSidebarCollapsed">Classes</span>
      </a>
      <a href="javascript:void(0)" class="menu-item" [class.active]="activeMenu === 'attendance'" (click)="setActiveMenu('attendance')">
        <i class="bi bi-calendar-check-fill"></i>
        <span *ngIf="!isSidebarCollapsed">Attendance</span>
      </a>
      <a href="javascript:void(0)" class="menu-item" [class.active]="activeMenu === 'fees'" (click)="setActiveMenu('fees')">
        <i class="bi bi-cash-coin"></i>
        <span *ngIf="!isSidebarCollapsed">Fee Management</span>
      </a>
      <a href="javascript:void(0)" class="menu-item" [class.active]="activeMenu === 'setting'" (click)="setActiveMenu('setting')">
        <i class="bi bi-gear-fill"></i>
        <span *ngIf="!isSidebarCollapsed">Settings</span>
      </a>
    </nav>

    <button class="logout-btn" (click)="onLogout()">
      <i class="bi bi-box-arrow-right"></i>
      <span *ngIf="!isSidebarCollapsed">Log Out</span>
    </button>
  </aside>

  <!-- Main Content -->
  <main class="main-content">
    
    <!-- Top Bar -->
    <header class="top-bar">
      <button class="menu-toggle" (click)="toggleSidebar()">
        <i class="bi bi-list"></i>
      </button>

      <div class="top-bar-right">
        <div class="notification-wrapper">
          <div class="notification-badge" (click)="toggleNotificationDropdown()">
            <i class="bi bi-bell-fill"></i>
            <span class="badge" *ngIf="notificationCount > 0">{{ notificationCount }}</span>
          </div>

          <div class="notification-dropdown" *ngIf="showNotificationDropdown">
            <div class="notification-header">
              <h3>Notifications</h3>
              <button class="mark-all-read" (click)="markAllAsRead()" *ngIf="notificationCount > 0">
                Mark all as read
              </button>
            </div>

            <div class="notification-list">
              <div *ngFor="let notification of notifications" 
                   class="notification-item" 
                   [class.unread]="!notification.read"
                   [class.notification-success]="notification.type === 'success'"
                   [class.notification-info]="notification.type === 'info'"
                   [class.notification-warning]="notification.type === 'warning'"
                   [class.notification-error]="notification.type === 'error'"
                   (click)="markAsRead(notification.id)">
                <div class="notification-icon">
                  <i class="bi" [ngClass]="notification.icon"></i>
                </div>
                <div class="notification-content">
                  <h4>{{ notification.title }}</h4>
                  <p>{{ notification.message }}</p>
                  <span class="notification-time">{{ getTimeAgo(notification.timestamp) }}</span>
                </div>
                <button class="delete-notification" (click)="deleteNotification(notification.id, $event)">
                  <i class="bi bi-x"></i>
                </button>
              </div>

              <div class="no-notifications" *ngIf="notifications.length === 0">
                <i class="bi bi-bell-slash"></i>
                <p>No notifications</p>
              </div>
            </div>
          </div>
        </div>

        <div class="user-profile">
          <img src="https://ui-avatars.com/api/?name={{ userName }}&background=3b82f6&color=fff" alt="User">
          <div class="user-info">
            <span class="user-name">{{ userName }}</span>
            <span class="user-role" [ngClass]="getRoleBadgeClass()">{{ userRole }}</span>
          </div>
        </div>
      </div>
    </header>

    <!-- Students Content -->
    <div class="page-content">
      
      <!-- Page Header -->
      <div class="page-header">
        <div>
          <h2 class="page-title">Classes Management</h2>
          <p class="page-subtitle">Manage class schedules and assignments</p>
        </div>
        <button class="btn-primary" (click)="openAddModal()" *ngIf="canAdd()">
          <i class="bi bi-plus-lg"></i>
          Add New Class
        </button>
      </div>

      <!-- Search Bar -->
      <div class="search-section">
        <div class="search-box">
          <i class="bi bi-search"></i>
          <input type="text" placeholder="Search by class name, teacher, or room..." [(ngModel)]="searchQuery" (input)="searchClasses()">
        </div>
      </div>

      <!-- Students Table -->
      <div class="table-card">
        <table class="data-table">
          <thead>
            <tr>
              <th>Class Name</th>
              <th>Grade</th>
              <th>Section</th>
              <th>Class Teacher</th>
              <th>Subject</th>
              <th>Room</th>
              <th>Students</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let class of filteredClasses">
              <td>
                <div class="student-info">
                  <div class="student-avatar">{{ class.grade }}</div>
                  <span>{{ class.name }}</span>
                </div>
              </td>
              <td>{{ class.grade }}</td>
              <td><span class="class-badge">{{ class.section }}</span></td>
              <td>{{ class.classTeacher }}</td>
              <td>{{ class.subject }}</td>
              <td>{{ class.room }}</td>
              <td>{{ class.totalStudents }}</td>
              <td>
                <span class="status-badge" [class.status-paid]="class.status === 'active'" [class.status-pending]="class.status === 'inactive'">
                  {{ class.status }}
                </span>
              </td>
              <td>
                <div class="action-buttons">
                  <button class="btn-icon btn-view" (click)="viewClass(class)" title="View Details" *ngIf="canView()">
                    <i class="bi bi-eye-fill"></i>
                  </button>
                  <button class="btn-icon btn-edit" (click)="openEditModal(class)" title="Edit" *ngIf="canEdit()">
                    <i class="bi bi-pencil-fill"></i>
                  </button>
                  <button class="btn-icon btn-delete" (click)="openDeleteModal(class)" title="Delete" *ngIf="canDelete()">
                    <i class="bi bi-trash-fill"></i>
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>

        <div class="no-data" *ngIf="filteredClasses.length === 0">
          <i class="bi bi-inbox"></i>
          <p>No classes found</p>
        </div>
      </div>

    </div>
  </main>

</div>

<!-- View Class Modal -->
<div class="modal-overlay" *ngIf="showViewModal" (click)="closeViewModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Class Details</h3>
      <button class="modal-close" (click)="closeViewModal()">
        <i class="bi bi-x-lg"></i>
      </button>
    </div>
    
    <div class="modal-body" *ngIf="selectedClass">
      <div class="view-section">
        <div class="view-avatar">{{ selectedClass.grade }}</div>
        <h2 class="view-name">{{ selectedClass.name }}</h2>
      </div>

      <div class="view-details">
        <div class="detail-item">
          <span class="detail-label">Grade:</span>
          <span class="detail-value">{{ selectedClass.grade }}</span>
        </div>
        <div class="detail-item">
          <span class="detail-label">Section:</span>
          <span class="detail-value class-badge">{{ selectedClass.section }}</span>
        </div>
        <div class="detail-item">
          <span class="detail-label">Class Teacher:</span>
          <span class="detail-value">{{ selectedClass.classTeacher }}</span>
        </div>
        <div class="detail-item">
          <span class="detail-label">Subject:</span>
          <span class="detail-value">{{ selectedClass.subject }}</span>
        </div>
        <div class="detail-item">
          <span class="detail-label">Room:</span>
          <span class="detail-value">{{ selectedClass.room }}</span>
        </div>
        <div class="detail-item">
          <span class="detail-label">Total Students:</span>
          <span class="detail-value">{{ selectedClass.totalStudents }}</span>
        </div>
        <div class="detail-item">
          <span class="detail-label">Schedule:</span>
          <span class="detail-value">{{ selectedClass.schedule }}</span>
        </div>
        <div class="detail-item">
          <span class="detail-label">Status:</span>
          <span class="status-badge" [class.status-paid]="selectedClass.status === 'active'" [class.status-pending]="selectedClass.status === 'inactive'">
            {{ selectedClass.status }}
          </span>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn-secondary" (click)="closeViewModal()">Close</button>
    </div>
  </div>
</div>

<!-- Edit Class Modal -->
<div class="modal-overlay" *ngIf="showEditModal" (click)="closeEditModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Edit Class</h3>
      <button class="modal-close" (click)="closeEditModal()">
        <i class="bi bi-x-lg"></i>
      </button>
    </div>
    
    <div class="modal-body">
      <div class="form-row">
        <div class="form-group">
          <label>Class Name *</label>
          <input type="text" [(ngModel)]="editClass.name" class="form-control" placeholder="e.g., Class 10-A">
        </div>
        <div class="form-group">
          <label>Grade *</label>
          <input type="text" [(ngModel)]="editClass.grade" class="form-control" placeholder="e.g., 10">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Section *</label>
          <input type="text" [(ngModel)]="editClass.section" class="form-control" placeholder="e.g., A">
        </div>
        <div class="form-group">
          <label>Class Teacher *</label>
          <input type="text" [(ngModel)]="editClass.classTeacher" class="form-control" placeholder="Teacher name">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Subject</label>
          <input type="text" [(ngModel)]="editClass.subject" class="form-control" placeholder="e.g., Mathematics">
        </div>
        <div class="form-group">
          <label>Room</label>
          <input type="text" [(ngModel)]="editClass.room" class="form-control" placeholder="e.g., Room 101">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Total Students</label>
          <input type="number" [(ngModel)]="editClass.totalStudents" class="form-control" placeholder="30">
        </div>
        <div class="form-group">
          <label>Status</label>
          <select [(ngModel)]="editClass.status" class="form-control">
            <option value="active">Active</option>
            <option value="inactive">Inactive</option>
          </select>
        </div>
      </div>

      <div class="form-group">
        <label>Schedule</label>
        <input type="text" [(ngModel)]="editClass.schedule" class="form-control" placeholder="Mon-Fri, 8:00 AM - 2:00 PM">
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn-secondary" (click)="closeEditModal()">Cancel</button>
      <button class="btn-primary" (click)="updateClass()">Update Class</button>
    </div>
  </div>
</div>

<!-- Add Class Modal -->
<div class="modal-overlay" *ngIf="showAddModal" (click)="closeAddModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Add New Class</h3>
      <button class="modal-close" (click)="closeAddModal()">
        <i class="bi bi-x-lg"></i>
      </button>
    </div>
    
    <div class="modal-body">
      <div class="form-row">
        <div class="form-group">
          <label>Class Name *</label>
          <input type="text" [(ngModel)]="newClass.name" class="form-control" placeholder="e.g., Class 10-A">
        </div>
        <div class="form-group">
          <label>Grade *</label>
          <input type="text" [(ngModel)]="newClass.grade" class="form-control" placeholder="e.g., 10">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Section *</label>
          <input type="text" [(ngModel)]="newClass.section" class="form-control" placeholder="e.g., A">
        </div>
        <div class="form-group">
          <label>Class Teacher *</label>
          <input type="text" [(ngModel)]="newClass.classTeacher" class="form-control" placeholder="Teacher name">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Subject</label>
          <input type="text" [(ngModel)]="newClass.subject" class="form-control" placeholder="e.g., Mathematics">
        </div>
        <div class="form-group">
          <label>Room</label>
          <input type="text" [(ngModel)]="newClass.room" class="form-control" placeholder="e.g., Room 101">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Total Students</label>
          <input type="number" [(ngModel)]="newClass.totalStudents" class="form-control" placeholder="30">
        </div>
        <div class="form-group">
          <label>Schedule</label>
          <input type="text" [(ngModel)]="newClass.schedule" class="form-control" placeholder="Mon-Fri, 8:00 AM - 2:00 PM">
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn-secondary" (click)="closeAddModal()">Cancel</button>
      <button class="btn-primary" (click)="addClass()">Add Class</button>
    </div>
  </div>
</div>

<!-- Success Modal -->
<div class="success-modal-overlay" *ngIf="showSuccessModal">
  <div class="success-modal">
    <div class="success-icon-wrapper">
      <i class="bi" [ngClass]="successIcon"></i>
    </div>
    <h3 class="success-title">Success!</h3>
    <p class="success-message">{{ successMessage }}</p>
    <button class="btn-success" (click)="closeSuccessModal()">OK</button>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal-overlay" *ngIf="showDeleteModal" (click)="closeDeleteModal()">
  <div class="modal-content delete-modal" (click)="$event.stopPropagation()">
    <div class="modal-header delete-header">
      <div class="delete-icon-wrapper">
        <i class="bi bi-exclamation-triangle-fill"></i>
      </div>
      <h3>Confirm Delete</h3>
      <button class="modal-close" (click)="closeDeleteModal()">
        <i class="bi bi-x-lg"></i>
      </button>
    </div>
    
    <div class="modal-body" *ngIf="classToDelete">
      <p class="delete-message">
        Are you sure you want to delete <strong>{{ classToDelete.name }}</strong>?
      </p>
      <p class="delete-warning">
        <i class="bi bi-info-circle"></i>
        This action cannot be undone. All class records will be permanently removed.
      </p>
    </div>

    <div class="modal-footer">
      <button class="btn-secondary" (click)="closeDeleteModal()">Cancel</button>
      <button class="btn-danger" (click)="confirmDelete()">
        <i class="bi bi-trash-fill"></i>
        Delete Class
      </button>
    </div>
  </div>
</div>
