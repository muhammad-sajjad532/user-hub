<div class="dashboard-wrapper">
  
  <!-- Sidebar -->
  <aside class="sidebar" [class.collapsed]="isSidebarCollapsed">
    <div class="logo-section">
      <div class="logo">
        <i class="bi bi-mortarboard-fill"></i>
      </div>
      <h3 class="logo-text" *ngIf="!isSidebarCollapsed">School MS</h3>
    </div>

    <nav class="sidebar-menu">
      <a href="javascript:void(0)" class="menu-item" [class.active]="activeMenu === 'dashboard'" (click)="setActiveMenu('dashboard')">
        <i class="bi bi-grid-fill"></i>
        <span *ngIf="!isSidebarCollapsed">Dashboard</span>
      </a>
      <a href="javascript:void(0)" class="menu-item" [class.active]="activeMenu === 'students'" (click)="setActiveMenu('students')">
        <i class="bi bi-people-fill"></i>
        <span *ngIf="!isSidebarCollapsed">Students</span>
      </a>
      <a href="javascript:void(0)" class="menu-item" [class.active]="activeMenu === 'teachers'" (click)="setActiveMenu('teachers')">
        <i class="bi bi-person-badge-fill"></i>
        <span *ngIf="!isSidebarCollapsed">Teachers</span>
      </a>
      <a href="javascript:void(0)" class="menu-item" [class.active]="activeMenu === 'classes'" (click)="setActiveMenu('classes')">
        <i class="bi bi-book-fill"></i>
        <span *ngIf="!isSidebarCollapsed">Classes</span>
      </a>
      <a href="javascript:void(0)" class="menu-item" [class.active]="activeMenu === 'attendance'" (click)="setActiveMenu('attendance')">
        <i class="bi bi-calendar-check-fill"></i>
        <span *ngIf="!isSidebarCollapsed">Attendance</span>
      </a>
      <a href="javascript:void(0)" class="menu-item" [class.active]="activeMenu === 'fees'" (click)="setActiveMenu('fees')">
        <i class="bi bi-cash-coin"></i>
        <span *ngIf="!isSidebarCollapsed">Fee Management</span>
      </a>
      <a href="javascript:void(0)" class="menu-item" [class.active]="activeMenu === 'setting'" (click)="setActiveMenu('setting')">
        <i class="bi bi-gear-fill"></i>
        <span *ngIf="!isSidebarCollapsed">Settings</span>
      </a>
    </nav>

    <button class="logout-btn" (click)="onLogout()">
      <i class="bi bi-box-arrow-right"></i>
      <span *ngIf="!isSidebarCollapsed">Log Out</span>
    </button>
  </aside>

  <!-- Main Content -->
  <main class="main-content">
    
    <!-- Top Bar -->
    <header class="top-bar">
      <button class="menu-toggle" (click)="toggleSidebar()">
        <i class="bi bi-list"></i>
      </button>

      <div class="top-bar-right">
        <div class="notification-wrapper">
          <div class="notification-badge" (click)="toggleNotificationDropdown()">
            <i class="bi bi-bell-fill"></i>
            <span class="badge" *ngIf="notificationCount > 0">{{ notificationCount }}</span>
          </div>

          <div class="notification-dropdown" *ngIf="showNotificationDropdown">
            <div class="notification-header">
              <h3>Notifications</h3>
              <button class="mark-all-read" (click)="markAllAsRead()" *ngIf="notificationCount > 0">
                Mark all as read
              </button>
            </div>

            <div class="notification-list">
              <div *ngFor="let notification of notifications" 
                   class="notification-item" 
                   [class.unread]="!notification.read"
                   [class.notification-success]="notification.type === 'success'"
                   [class.notification-info]="notification.type === 'info'"
                   [class.notification-warning]="notification.type === 'warning'"
                   [class.notification-error]="notification.type === 'error'"
                   (click)="markAsRead(notification.id)">
                <div class="notification-icon">
                  <i class="bi" [ngClass]="notification.icon"></i>
                </div>
                <div class="notification-content">
                  <h4>{{ notification.title }}</h4>
                  <p>{{ notification.message }}</p>
                  <span class="notification-time">{{ getTimeAgo(notification.timestamp) }}</span>
                </div>
                <button class="delete-notification" (click)="deleteNotification(notification.id, $event)">
                  <i class="bi bi-x"></i>
                </button>
              </div>

              <div class="no-notifications" *ngIf="notifications.length === 0">
                <i class="bi bi-bell-slash"></i>
                <p>No notifications</p>
              </div>
            </div>
          </div>
        </div>

        <div class="user-profile">
          <img src="https://ui-avatars.com/api/?name={{ userName }}&background=3b82f6&color=fff" alt="User">
          <div class="user-info">
            <span class="user-name">{{ userName }}</span>
            <span class="user-role" [ngClass]="getRoleBadgeClass()">{{ userRole }}</span>
          </div>
        </div>
      </div>
    </header>

    <!-- Attendance Content -->
    <div class="page-content">
      
      <!-- Page Header -->
      <div class="page-header">
        <div>
          <h2 class="page-title">Attendance Management</h2>
          <p class="page-subtitle">Mark and track student attendance</p>
        </div>
      </div>

      <!-- Statistics Cards -->
      <div class="stats-grid" style="margin-bottom: 24px;">
        <div class="stat-card blue">
          <div class="stat-icon">
            <i class="bi bi-check-circle-fill"></i>
          </div>
          <div class="stat-info">
            <h3 class="stat-label">Present</h3>
            <p class="stat-value">{{ totalPresent }}</p>
          </div>
        </div>

        <div class="stat-card red">
          <div class="stat-icon">
            <i class="bi bi-x-circle-fill"></i>
          </div>
          <div class="stat-info">
            <h3 class="stat-label">Absent</h3>
            <p class="stat-value">{{ totalAbsent }}</p>
          </div>
        </div>

        <div class="stat-card orange">
          <div class="stat-icon">
            <i class="bi bi-clock-fill"></i>
          </div>
          <div class="stat-info">
            <h3 class="stat-label">Late</h3>
            <p class="stat-value">{{ totalLate }}</p>
          </div>
        </div>

        <div class="stat-card green">
          <div class="stat-icon">
            <i class="bi bi-graph-up-arrow"></i>
          </div>
          <div class="stat-info">
            <h3 class="stat-label">Attendance %</h3>
            <p class="stat-value">{{ attendancePercentage }}%</p>
          </div>
        </div>
      </div>

      <!-- Filters -->
      <div class="filters-section">
        <div class="filter-group">
          <label>Date:</label>
          <input type="date" [(ngModel)]="selectedDate" (change)="filterAttendance()" class="form-control">
        </div>
        <div class="filter-group">
          <label>Class:</label>
          <select [(ngModel)]="selectedClass" (change)="filterAttendance()" class="form-control">
            <option value="all">All Classes</option>
            <option *ngFor="let class of classes" [value]="class">{{ class }}</option>
          </select>
        </div>
        <div class="filter-group" style="flex: 1;">
          <label>Search:</label>
          <input type="text" [(ngModel)]="searchQuery" (input)="filterAttendance()" class="form-control" placeholder="Search student...">
        </div>
      </div>

      <!-- Students List for Attendance -->
      <div class="table-card">
        <table class="data-table">
          <thead>
            <tr>
              <th>Roll No</th>
              <th>Student Name</th>
              <th>Class</th>
              <th>Status</th>
              <th>Mark Attendance</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let student of filteredStudents">
              <td>{{ student.rollNumber }}</td>
              <td>
                <div class="student-info">
                  <div class="student-avatar">{{ student.name.charAt(0) }}</div>
                  <span>{{ student.name }}</span>
                </div>
              </td>
              <td><span class="class-badge">{{ student.class }}</span></td>
              <td>
                <span class="status-badge" 
                      [class.status-present]="getStudentStatus(student.id) === 'present'"
                      [class.status-absent]="getStudentStatus(student.id) === 'absent'"
                      [class.status-late]="getStudentStatus(student.id) === 'late'"
                      [class.status-unmarked]="!getStudentStatus(student.id)">
                  {{ getStudentStatus(student.id) || 'Not Marked' }}
                </span>
              </td>
              <td>
                <div class="attendance-buttons" *ngIf="canMark()">
                  <button class="btn-attendance btn-present" (click)="markAttendance(student.id, 'present')" title="Mark Present">
                    <i class="bi bi-check-lg"></i>
                  </button>
                  <button class="btn-attendance btn-absent" (click)="markAttendance(student.id, 'absent')" title="Mark Absent">
                    <i class="bi bi-x-lg"></i>
                  </button>
                  <button class="btn-attendance btn-late" (click)="markAttendance(student.id, 'late')" title="Mark Late">
                    <i class="bi bi-clock"></i>
                  </button>
                </div>
                <span *ngIf="!canMark()" class="text-muted">No permission</span>
              </td>
            </tr>
          </tbody>
        </table>

        <div class="no-data" *ngIf="filteredStudents.length === 0">
          <i class="bi bi-inbox"></i>
          <p>No students found for selected filters</p>
        </div>
      </div>

    </div>
  </main>

</div>

<!-- Success Modal -->
<div class="success-modal-overlay" *ngIf="showSuccessModal">
  <div class="success-modal">
    <div class="success-icon-wrapper">
      <i class="bi" [ngClass]="successIcon"></i>
    </div>
    <h3 class="success-title">Success!</h3>
    <p class="success-message">{{ successMessage }}</p>
    <button class="btn-success" (click)="closeSuccessModal()">OK</button>
  </div>
</div>
