<div class="dashboard-wrapper">
  
  <!-- Sidebar -->
  <aside class="sidebar" [class.collapsed]="isSidebarCollapsed">
    <div class="logo-section">
      <div class="logo">
        <i class="bi bi-mortarboard-fill"></i>
      </div>
      <h3 class="logo-text" *ngIf="!isSidebarCollapsed">School MS</h3>
    </div>

    <nav class="sidebar-menu">
      <a href="javascript:void(0)" class="menu-item" [class.active]="activeMenu === 'dashboard'" (click)="setActiveMenu('dashboard')">
        <i class="bi bi-grid-fill"></i>
        <span *ngIf="!isSidebarCollapsed">Dashboard</span>
      </a>
      <a href="javascript:void(0)" class="menu-item" [class.active]="activeMenu === 'students'" (click)="setActiveMenu('students')">
        <i class="bi bi-people-fill"></i>
        <span *ngIf="!isSidebarCollapsed">Students</span>
      </a>
      <a href="javascript:void(0)" class="menu-item" [class.active]="activeMenu === 'teachers'" (click)="setActiveMenu('teachers')">
        <i class="bi bi-person-badge-fill"></i>
        <span *ngIf="!isSidebarCollapsed">Teachers</span>
      </a>
      <a href="javascript:void(0)" class="menu-item" [class.active]="activeMenu === 'classes'" (click)="setActiveMenu('classes')">
        <i class="bi bi-book-fill"></i>
        <span *ngIf="!isSidebarCollapsed">Classes</span>
      </a>
      <a href="javascript:void(0)" class="menu-item" [class.active]="activeMenu === 'attendance'" (click)="setActiveMenu('attendance')">
        <i class="bi bi-calendar-check-fill"></i>
        <span *ngIf="!isSidebarCollapsed">Attendance</span>
      </a>
      <a href="javascript:void(0)" class="menu-item" [class.active]="activeMenu === 'fees'" (click)="setActiveMenu('fees')">
        <i class="bi bi-cash-coin"></i>
        <span *ngIf="!isSidebarCollapsed">Fee Management</span>
      </a>
      <a href="javascript:void(0)" class="menu-item" [class.active]="activeMenu === 'setting'" (click)="setActiveMenu('setting')">
        <i class="bi bi-gear-fill"></i>
        <span *ngIf="!isSidebarCollapsed">Settings</span>
      </a>
    </nav>

    <button class="logout-btn" (click)="onLogout()">
      <i class="bi bi-box-arrow-right"></i>
      <span *ngIf="!isSidebarCollapsed">Log Out</span>
    </button>
  </aside>

  <!-- Main Content -->
  <main class="main-content">
    
    <!-- Top Bar -->
    <header class="top-bar">
      <button class="menu-toggle" (click)="toggleSidebar()">
        <i class="bi bi-list"></i>
      </button>

      <div class="top-bar-right">
        <div class="notification-wrapper">
          <div class="notification-badge" (click)="toggleNotificationDropdown()">
            <i class="bi bi-bell-fill"></i>
            <span class="badge" *ngIf="notificationCount > 0">{{ notificationCount }}</span>
          </div>

          <div class="notification-dropdown" *ngIf="showNotificationDropdown">
            <div class="notification-header">
              <h3>Notifications</h3>
              <button class="mark-all-read" (click)="markAllAsRead()" *ngIf="notificationCount > 0">
                Mark all as read
              </button>
            </div>

            <div class="notification-list">
              <div *ngFor="let notification of notifications" 
                   class="notification-item" 
                   [class.unread]="!notification.read"
                   [class.notification-success]="notification.type === 'success'"
                   [class.notification-info]="notification.type === 'info'"
                   [class.notification-warning]="notification.type === 'warning'"
                   [class.notification-error]="notification.type === 'error'"
                   (click)="markAsRead(notification.id)">
                <div class="notification-icon">
                  <i class="bi" [ngClass]="notification.icon"></i>
                </div>
                <div class="notification-content">
                  <h4>{{ notification.title }}</h4>
                  <p>{{ notification.message }}</p>
                  <span class="notification-time">{{ getTimeAgo(notification.timestamp) }}</span>
                </div>
                <button class="delete-notification" (click)="deleteNotification(notification.id, $event)">
                  <i class="bi bi-x"></i>
                </button>
              </div>

              <div class="no-notifications" *ngIf="notifications.length === 0">
                <i class="bi bi-bell-slash"></i>
                <p>No notifications</p>
              </div>
            </div>
          </div>
        </div>

        <div class="user-profile">
          <img src="https://ui-avatars.com/api/?name={{ userName }}&background=3b82f6&color=fff" alt="User">
          <div class="user-info">
            <span class="user-name">{{ userName }}</span>
            <span class="user-role" [ngClass]="getRoleBadgeClass()">{{ userRole }}</span>
          </div>
        </div>
      </div>
    </header>

    <!-- Students Content -->
    <div class="page-content">
      
      <!-- Page Header -->
      <div class="page-header">
        <div>
          <h2 class="page-title">Teachers Management</h2>
          <p class="page-subtitle">Manage teaching staff records and information</p>
        </div>
        <button class="btn-primary" (click)="openAddModal()" *ngIf="canAdd()">
          <i class="bi bi-plus-lg"></i>
          Add New Teacher
        </button>
      </div>

      <!-- Search Bar -->
      <div class="search-section">
        <div class="search-box">
          <i class="bi bi-search"></i>
          <input type="text" placeholder="Search by name, subject, or email..." [(ngModel)]="searchQuery" (input)="searchTeachers()">
        </div>
      </div>

      <!-- Students Table -->
      <div class="table-card">
        <table class="data-table">
          <thead>
            <tr>
              <th>Teacher Name</th>
              <th>Qualification</th>
              <th>Subject</th>
              <th>Email</th>
              <th>Phone</th>
              <th>Joining Date</th>
              <th>Salary</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let teacher of filteredTeachers">
              <td>
                <div class="student-info">
                  <div class="student-avatar">{{ teacher.name.charAt(0) }}</div>
                  <span>{{ teacher.name }}</span>
                </div>
              </td>
              <td>{{ teacher.qualification }}</td>
              <td><span class="class-badge">{{ teacher.subject }}</span></td>
              <td>{{ teacher.email }}</td>
              <td>{{ teacher.phone }}</td>
              <td>{{ teacher.joiningDate }}</td>
              <td>₨{{ teacher.salary.toLocaleString() }}</td>
              <td>
                <span class="status-badge" [class.status-paid]="teacher.status === 'active'" [class.status-pending]="teacher.status === 'inactive'">
                  {{ teacher.status }}
                </span>
              </td>
              <td>
                <div class="action-buttons">
                  <button class="btn-icon btn-view" (click)="viewTeacher(teacher)" title="View Details" *ngIf="canView()">
                    <i class="bi bi-eye-fill"></i>
                  </button>
                  <button class="btn-icon btn-edit" (click)="openEditModal(teacher)" title="Edit" *ngIf="canEdit()">
                    <i class="bi bi-pencil-fill"></i>
                  </button>
                  <button class="btn-icon btn-delete" (click)="openDeleteModal(teacher)" title="Delete" *ngIf="canDelete()">
                    <i class="bi bi-trash-fill"></i>
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>

        <div class="no-data" *ngIf="filteredTeachers.length === 0">
          <i class="bi bi-inbox"></i>
          <p>No teachers found</p>
        </div>
      </div>

    </div>
  </main>

</div>

<!-- View Teacher Modal -->
<div class="modal-overlay" *ngIf="showViewModal" (click)="closeViewModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Teacher Details</h3>
      <button class="modal-close" (click)="closeViewModal()">
        <i class="bi bi-x-lg"></i>
      </button>
    </div>
    
    <div class="modal-body" *ngIf="selectedTeacher">
      <div class="view-section">
        <div class="view-avatar">{{ selectedTeacher.name.charAt(0) }}</div>
        <h2 class="view-name">{{ selectedTeacher.name }}</h2>
      </div>

      <div class="view-details">
        <div class="detail-item">
          <span class="detail-label">Qualification:</span>
          <span class="detail-value">{{ selectedTeacher.qualification }}</span>
        </div>
        <div class="detail-item">
          <span class="detail-label">Subject:</span>
          <span class="detail-value class-badge">{{ selectedTeacher.subject }}</span>
        </div>
        <div class="detail-item">
          <span class="detail-label">Email:</span>
          <span class="detail-value">{{ selectedTeacher.email }}</span>
        </div>
        <div class="detail-item">
          <span class="detail-label">Phone Number:</span>
          <span class="detail-value">{{ selectedTeacher.phone }}</span>
        </div>
        <div class="detail-item">
          <span class="detail-label">Address:</span>
          <span class="detail-value">{{ selectedTeacher.address }}</span>
        </div>
        <div class="detail-item">
          <span class="detail-label">Joining Date:</span>
          <span class="detail-value">{{ selectedTeacher.joiningDate }}</span>
        </div>
        <div class="detail-item">
          <span class="detail-label">Salary:</span>
          <span class="detail-value">₨{{ selectedTeacher.salary.toLocaleString() }}</span>
        </div>
        <div class="detail-item">
          <span class="detail-label">Status:</span>
          <span class="status-badge" [class.status-paid]="selectedTeacher.status === 'active'" [class.status-pending]="selectedTeacher.status === 'inactive'">
            {{ selectedTeacher.status }}
          </span>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn-secondary" (click)="closeViewModal()">Close</button>
    </div>
  </div>
</div>

<!-- Edit Teacher Modal -->
<div class="modal-overlay" *ngIf="showEditModal" (click)="closeEditModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Edit Teacher</h3>
      <button class="modal-close" (click)="closeEditModal()">
        <i class="bi bi-x-lg"></i>
      </button>
    </div>
    
    <div class="modal-body">
      <div class="form-row">
        <div class="form-group">
          <label>Teacher Name *</label>
          <input type="text" [(ngModel)]="editTeacher.name" class="form-control" placeholder="Enter teacher name">
        </div>
        <div class="form-group">
          <label>Qualification *</label>
          <input type="text" [(ngModel)]="editTeacher.qualification" class="form-control" placeholder="e.g., MSc Physics">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Subject *</label>
          <input type="text" [(ngModel)]="editTeacher.subject" class="form-control" placeholder="e.g., Mathematics">
        </div>
        <div class="form-group">
          <label>Email *</label>
          <input type="email" [(ngModel)]="editTeacher.email" class="form-control" placeholder="teacher@school.com">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Phone Number</label>
          <input type="tel" [(ngModel)]="editTeacher.phone" class="form-control" placeholder="0321-1234567">
        </div>
        <div class="form-group">
          <label>Joining Date</label>
          <input type="date" [(ngModel)]="editTeacher.joiningDate" class="form-control">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Salary (₨)</label>
          <input type="number" [(ngModel)]="editTeacher.salary" class="form-control" placeholder="50000">
        </div>
        <div class="form-group">
          <label>Status</label>
          <select [(ngModel)]="editTeacher.status" class="form-control">
            <option value="active">Active</option>
            <option value="inactive">Inactive</option>
          </select>
        </div>
      </div>

      <div class="form-group">
        <label>Address</label>
        <textarea [(ngModel)]="editTeacher.address" class="form-control" rows="2" placeholder="Enter address"></textarea>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn-secondary" (click)="closeEditModal()">Cancel</button>
      <button class="btn-primary" (click)="updateTeacher()">Update Teacher</button>
    </div>
  </div>
</div>

<!-- Add Teacher Modal -->
<div class="modal-overlay" *ngIf="showAddModal" (click)="closeAddModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Add New Teacher</h3>
      <button class="modal-close" (click)="closeAddModal()">
        <i class="bi bi-x-lg"></i>
      </button>
    </div>
    
    <div class="modal-body">
      <div class="form-row">
        <div class="form-group">
          <label>Teacher Name *</label>
          <input type="text" [(ngModel)]="newTeacher.name" class="form-control" placeholder="Enter teacher name">
        </div>
        <div class="form-group">
          <label>Qualification *</label>
          <input type="text" [(ngModel)]="newTeacher.qualification" class="form-control" placeholder="e.g., MSc Physics">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Subject *</label>
          <input type="text" [(ngModel)]="newTeacher.subject" class="form-control" placeholder="e.g., Mathematics">
        </div>
        <div class="form-group">
          <label>Email *</label>
          <input type="email" [(ngModel)]="newTeacher.email" class="form-control" placeholder="teacher@school.com">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Phone Number</label>
          <input type="tel" [(ngModel)]="newTeacher.phone" class="form-control" placeholder="0321-1234567">
        </div>
        <div class="form-group">
          <label>Joining Date</label>
          <input type="date" [(ngModel)]="newTeacher.joiningDate" class="form-control">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Salary (₨)</label>
          <input type="number" [(ngModel)]="newTeacher.salary" class="form-control" placeholder="50000">
        </div>
        <div class="form-group">
          <label>Address</label>
          <input type="text" [(ngModel)]="newTeacher.address" class="form-control" placeholder="Enter address">
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn-secondary" (click)="closeAddModal()">Cancel</button>
      <button class="btn-primary" (click)="addTeacher()">Add Teacher</button>
    </div>
  </div>
</div>

<!-- Success Modal -->
<div class="success-modal-overlay" *ngIf="showSuccessModal">
  <div class="success-modal">
    <div class="success-icon-wrapper">
      <i class="bi" [ngClass]="successIcon"></i>
    </div>
    <h3 class="success-title">Success!</h3>
    <p class="success-message">{{ successMessage }}</p>
    <button class="btn-success" (click)="closeSuccessModal()">OK</button>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal-overlay" *ngIf="showDeleteModal" (click)="closeDeleteModal()">
  <div class="modal-content delete-modal" (click)="$event.stopPropagation()">
    <div class="modal-header delete-header">
      <div class="delete-icon-wrapper">
        <i class="bi bi-exclamation-triangle-fill"></i>
      </div>
      <h3>Confirm Delete</h3>
      <button class="modal-close" (click)="closeDeleteModal()">
        <i class="bi bi-x-lg"></i>
      </button>
    </div>
    
    <div class="modal-body" *ngIf="teacherToDelete">
      <p class="delete-message">
        Are you sure you want to delete <strong>{{ teacherToDelete.name }}</strong>?
      </p>
      <p class="delete-warning">
        <i class="bi bi-info-circle"></i>
        This action cannot be undone. All teacher records will be permanently removed.
      </p>
    </div>

    <div class="modal-footer">
      <button class="btn-secondary" (click)="closeDeleteModal()">Cancel</button>
      <button class="btn-danger" (click)="confirmDelete()">
        <i class="bi bi-trash-fill"></i>
        Delete Teacher
      </button>
    </div>
  </div>
</div>
